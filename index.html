<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C√¥ng b·ªë ng∆∞·ªùi tr√∫ng gi·∫£i</title>
  <style>
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
      min-height: 100vh;
      padding: 40px 20px;
      color: #333;
    }

    .container { 
      max-width: 100%;
      margin: 0 auto;
    }

    /* Input Section */
    .input-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 40px;
      border-radius: 25px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      margin: 0 auto 100px;
      max-width: 800px;
    }

    .input-section h1 {
      text-align: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 30px;
      font-size: 2.5em;
      font-weight: 900;
      letter-spacing: 1px;
    }

    .input-group {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
    }

    .input-group input {
      padding: 18px 25px;
      font-size: 1.3em;
      border: 3px solid #667eea;
      border-radius: 15px;
      width: 160px;
      text-align: center;
      font-weight: bold;
      transition: all 0.3s;
      background: white;
    }

    .input-group input:focus {
      outline: none;
      border-color: #764ba2;
      transform: scale(1.05);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .btn {
      padding: 18px 50px;
      font-size: 1.3em;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .btn:hover { 
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
    }

    .btn:active {
      transform: translateY(-1px);
    }

    /* Winners Section */
    .winners-section { 
      display: none;
      padding-top: 40px;
    }
    
    .winners-section.show { 
      display: block; 
    }

    .winners-container {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 120px;
      max-width: 1800px;
      margin: 0 auto;
      padding: 0 40px;
    }

    /* Winner Cards */
    .winner-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .winner-card {
      background: white;
      border-radius: 30px;
      overflow: visible;
      box-shadow: 0 15px 50px rgba(0,0,0,0.3);
      width: 450px;
      transition: all 0.4s;
      position: relative;
    }

    .winner-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    }

    /* Top 1 Styling */
    .winner-wrapper.rank-1 .winner-card {
      border: 8px solid #FFD700;
      box-shadow: 0 0 60px rgba(255, 215, 0, 0.8), 0 20px 60px rgba(0,0,0,0.4);
      transform: scale(1.1);
    }

    .winner-wrapper.rank-1 .winner-card:hover {
      transform: scale(1.1) translateY(-10px);
    }

    /* Second and Third Place */
    .winner-wrapper.rank-2,
    .winner-wrapper.rank-3 {
      margin-top: 80px;
    }

    .winner-wrapper.rank-2 .winner-card {
      border: 6px solid #C0C0C0;
    }

    .winner-wrapper.rank-3 .winner-card {
      border: 6px solid #CD7F32;
    }

    /* Image Container */
    .winner-image-container {
      width: 100%;
      height: 500px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 30px;
      border-radius: 30px 30px 0 0;
    }

    .winner-image {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      border-radius: 15px;
    }

    /* Info Section */
    .winner-info {
      padding: 35px 30px;
      text-align: center;
      background: white;
      border-radius: 0 0 30px 30px;
    }

    .rank-badge {
      display: inline-block;
      padding: 10px 25px;
      border-radius: 50px;
      font-size: 2.5em;
      font-weight: 900;
      margin-bottom: 15px;
    }

    .winner-wrapper.rank-1 .rank-badge {
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .winner-wrapper.rank-2 .rank-badge {
      background: linear-gradient(135deg, #C0C0C0 0%, #808080 100%);
      color: white;
    }

    .winner-wrapper.rank-3 .rank-badge {
      background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
      color: white;
    }

    .winner-code { 
      font-size: 2.5em; 
      font-weight: 900; 
      color: #667eea; 
      margin-bottom: 15px;
      letter-spacing: 2px;
    }
    
    .winner-name { 
      font-size: 2em; 
      font-weight: bold; 
      margin-bottom: 12px; 
      color: #1a202c;
    }
    
    .winner-school { 
      font-size: 1.4em; 
      color: #4a5568; 
      margin-bottom: 10px;
      line-height: 1.4;
    }
    
    .winner-age { 
      font-size: 1.2em; 
      color: #718096;
      font-weight: 600;
    }

    /* Loading and Error */
    .loading { 
      text-align: center; 
      padding: 50px; 
      font-size: 2em; 
      color: white;
      font-weight: bold;
    }
    
    .error {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
      color: white; 
      padding: 30px; 
      border-radius: 20px;
      text-align: center; 
      margin: 40px auto;
      font-size: 1.4em;
      max-width: 700px;
      box-shadow: 0 10px 40px rgba(255, 107, 107, 0.4);
      font-weight: bold;
    }

    /* Responsive */
    @media (max-width: 1600px) {
      .winners-container {
        gap: 80px;
      }

      .winner-card {
        width: 400px;
      }

      .winner-image-container {
        height: 450px;
      }
    }

    @media (max-width: 1300px) {
      .winners-container {
        flex-direction: column;
        align-items: center;
        gap: 60px;
      }

      .winner-wrapper.rank-2,
      .winner-wrapper.rank-3 {
        margin-top: 0;
      }

      .winner-wrapper.rank-1 .winner-card {
        transform: scale(1);
      }

      .winner-wrapper.rank-1 .winner-card:hover {
        transform: translateY(-10px);
      }

      .winner-card {
        width: 100%;
        max-width: 500px;
      }
    }

    @media (max-width: 600px) {
      .input-section {
        padding: 25px;
      }

      .input-section h1 {
        font-size: 1.8em;
      }

      .input-group input {
        width: 120px;
        font-size: 1.1em;
        padding: 15px 20px;
      }

      .btn {
        padding: 15px 35px;
        font-size: 1.1em;
      }

      .winner-card {
        max-width: 100%;
      }

      .winner-image-container {
        height: 350px;
        padding: 20px;
      }

      .winner-code {
        font-size: 2em;
      }

      .winner-name {
        font-size: 1.6em;
      }

      .winner-school {
        font-size: 1.2em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="input-section" id="inputSection">
      <h1>üéâ C√îNG B·ªê NG∆Ø·ªúI TR√öNG GI·∫¢I üéâ</h1>
      <div class="input-group">
        <input type="text" id="code1" placeholder="#001" maxlength="4">
        <input type="text" id="code2" placeholder="#002" maxlength="4">
        <input type="text" id="code3" placeholder="#003" maxlength="4">
        <button class="btn" onclick="loadWinners()">HI·ªÇN TH·ªä</button>
      </div>
    </div>

    <div class="loading" id="loading" style="display: none;">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</div>
    <div class="error" id="error" style="display: none;"></div>

    <div class="winners-section" id="winnersSection">
      <div class="winners-container" id="winnersContainer"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    const SHEET_ID = "1ZID_T4OaP5fUs2q1iQXefVBs0H--MgM9DtBQz2WOm7M";
    const SHEET_CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;

    async function loadWinners() {
      const codes = ['code1', 'code2', 'code3'].map(id => {
        let v = document.getElementById(id).value.trim().toUpperCase();
        return v.startsWith('#') ? v : ('#' + v);
      });

      document.getElementById('loading').style.display = 'block';
      document.getElementById('error').style.display = 'none';
      document.getElementById('winnersSection').classList.remove('show');

      try {
        const res = await fetch(SHEET_CSV_URL);
        if (!res.ok) throw new Error('Network error');
        
        const csvText = await res.text();

        Papa.parse(csvText, {
          header: false,
          skipEmptyLines: true,
          complete: (results) => {
            const data = results.data;
            const found = [];

            for (let i = 1; i < data.length; i++) {
              const row = data[i];
              if (row && row[4] && codes.includes(row[4].trim().toUpperCase())) {
                found.push({
                  name: row[0] || 'N/A',
                  school: row[1] || 'N/A',
                  age: row[2] || 'N/A',
                  image: row[3] || '',
                  code: row[4].trim().toUpperCase()
                });
              }
            }

            if (found.length < 3) {
              showError(`‚ùå Kh√¥ng t√¨m ƒë·ªß 3 ng∆∞·ªùi tr√∫ng gi·∫£i! Ch·ªâ t√¨m th·∫•y: ${found.length}`);
              return;
            }

            const ordered = [found[1], found[0], found[2]];
            displayWinners(ordered);
          },
          error: (error) => {
            showError("‚ùå L·ªói ph√¢n t√≠ch d·ªØ li·ªáu t·ª´ Google Sheets!");
            console.error(error);
          }
        });
      } catch (error) {
        showError("‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn Google Sheets!");
        console.error(error);
      }
    }

    function showError(msg) {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').textContent = msg;
      document.getElementById('error').style.display = 'block';
    }

    function displayWinners(winners) {
      const container = document.getElementById('winnersContainer');
      container.innerHTML = '';

      const emojis = ['ü•à', 'ü•á', 'ü•â'];
      const rankNames = ['H·∫°ng 2', 'H·∫°ng 1', 'H·∫°ng 3'];

      winners.forEach((winner, index) => {
        const wrapper = document.createElement('div');
        wrapper.className = `winner-wrapper rank-${index === 1 ? 1 : (index === 0 ? 2 : 3)}`;
        
        wrapper.innerHTML = `
          <div class="winner-card">
            <div class="winner-image-container">
              <img src="${winner.image}" 
                   class="winner-image" 
                   alt="${winner.name}"
                   onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22400%22%3E%3Crect fill=%22%23ddd%22 width=%22400%22 height=%22400%22/%3E%3Ctext fill=%22%23999%22 font-size=%2240%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22%3ENo Image%3C/text%3E%3C/svg%3E'">
            </div>
            <div class="winner-info">
              <div class="rank-badge">${emojis[index]}</div>
              <div class="winner-code">${winner.code}</div>
              <div class="winner-name">${winner.name}</div>
              <div class="winner-school">${winner.school}</div>
              <div class="winner-age">Tu·ªïi: ${winner.age}</div>
            </div>
          </div>
        `;
        
        container.appendChild(wrapper);
      });

      document.getElementById('loading').style.display = 'none';
      document.getElementById('winnersSection').classList.add('show');
    }
  </script>
</body>
</html>
