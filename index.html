<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C√¥ng b·ªë ng∆∞·ªùi tr√∫ng gi·∫£i</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    .container { 
      max-width: 1800px; 
      margin: 0 auto; 
    }

    .input-section {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      margin-bottom: 80px;
      position: relative;
      z-index: 100;
    }

    .input-section h1 {
      text-align: center;
      color: #667eea;
      margin-bottom: 20px;
      font-size: 2em;
      font-weight: bold;
    }

    .input-group {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .input-group input {
      padding: 15px 20px;
      font-size: 1.2em;
      border: 2px solid #667eea;
      border-radius: 10px;
      width: 150px;
      text-align: center;
      font-weight: bold;
    }

    .btn {
      padding: 15px 40px;
      font-size: 1.2em;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.2s;
    }

    .btn:hover { transform: scale(1.05); }

    .winners-section { 
      display: none;
      position: relative;
      z-index: 1;
    }
    
    .winners-section.show { display: block; }

    .winners-grid {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 80px;
      padding: 40px 20px;
      flex-wrap: wrap;
    }

    .winner-card {
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      width: 380px;
      flex-shrink: 0;
    }

    .winner-card.position-2,
    .winner-card.position-3 {
      margin-top: 60px;
    }

    .winner-card.top1 {
      border: 6px solid gold;
      box-shadow: 0 0 40px rgba(255, 215, 0, 0.7);
    }

    .winner-image-wrapper {
      width: 100%;
      height: 400px;
      background: #f4f4f4;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px;
      overflow: hidden;
    }

    .winner-image {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      display: block;
    }

    .winner-info {
      padding: 30px 20px;
      text-align: center;
      background: white;
    }

    .winner-code { 
      font-size: 2.2em; 
      font-weight: bold; 
      color: #667eea; 
      margin-bottom: 12px; 
    }
    
    .winner-name { 
      font-size: 1.6em; 
      font-weight: bold; 
      margin-bottom: 10px; 
      color: #333;
    }
    
    .winner-school { 
      font-size: 1.2em; 
      color: #666; 
      margin-bottom: 8px; 
    }
    
    .winner-age { 
      font-size: 1.1em; 
      color: #999; 
    }

    .loading { 
      text-align: center; 
      padding: 30px; 
      font-size: 1.5em; 
      color: white; 
    }
    
    .error {
      background: #ff6b6b; 
      color: white; 
      padding: 20px; 
      border-radius: 10px;
      text-align: center; 
      margin: 20px auto;
      font-size: 1.2em;
      max-width: 600px;
    }

    @media (max-width: 1400px) {
      .winners-grid { 
        gap: 40px;
      }
      
      .winner-card {
        width: 320px;
      }

      .winner-image-wrapper {
        height: 350px;
      }
    }

    @media (max-width: 1100px) {
      .winners-grid { 
        flex-direction: column;
        align-items: center;
        gap: 40px;
      }
      
      .winner-card.position-2,
      .winner-card.position-3 {
        margin-top: 0;
      }

      .winner-card {
        width: 100%;
        max-width: 450px;
      }
      
      .container {
        max-width: 600px;
      }
    }
  </style>

</head>
<body>
  <div class="container">

    <div class="input-section" id="inputSection">
      <h1>üéâ C√îNG B·ªê NG∆Ø·ªúI TR√öNG GI·∫¢I üéâ</h1>
      <div class="input-group">
        <input type="text" id="code1" placeholder="#001" maxlength="4">
        <input type="text" id="code2" placeholder="#002" maxlength="4">
        <input type="text" id="code3" placeholder="#003" maxlength="4">
        <button class="btn" onclick="loadWinners()">HI·ªÇN TH·ªä</button>
      </div>
    </div>

    <div class="loading" id="loading" style="display: none;">‚è≥ ƒêang t·∫£i...</div>
    <div class="error" id="error" style="display: none;"></div>

    <div class="winners-section" id="winnersSection">
      <div class="winners-grid" id="winnersGrid"></div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    const SHEET_ID = "1ZID_T4OaP5fUs2q1iQXefVBs0H--MgM9DtBQz2WOm7M";
    const SHEET_CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;

    async function loadWinners() {
      const codes = ['code1','code2','code3'].map(id => {
        let v = document.getElementById(id).value.trim().toUpperCase();
        return v.startsWith('#') ? v : ('#' + v);
      });

      document.getElementById('loading').style.display = 'block';
      document.getElementById('error').style.display = 'none';
      document.getElementById('winnersSection').classList.remove('show');

      try {
        const res = await fetch(SHEET_CSV_URL);
        const csvText = await res.text();

        Papa.parse(csvText, {
          header: false,
          skipEmptyLines: true,
          complete: (results) => {
            const data = results.data;
            const found = [];

            for (let i = 1; i < data.length; i++) {
              if (data[i] && data[i][4] && codes.includes(data[i][4])) {
                found.push({
                  name: data[i][0] || 'N/A',
                  school: data[i][1] || 'N/A',
                  age: data[i][2] || 'N/A',
                  image: data[i][3] || '',
                  code: data[i][4]
                });
              }
            }

            if (found.length !== 3) {
              showError("‚ùå Kh√¥ng t√¨m ƒë·ªß 3 ng∆∞·ªùi tr√∫ng gi·∫£i! T√¨m th·∫•y: " + found.length);
              return;
            }

            const ordered = [found[1], found[0], found[2]];
            displayWinners(ordered);
          },
          error: (error) => {
            showError("‚ùå L·ªói ph√¢n t√≠ch d·ªØ li·ªáu!");
            console.error(error);
          }
        });
      } catch (error) {
        showError("‚ùå L·ªói k·∫øt n·ªëi Google Sheets!");
        console.error(error);
      }
    }

    function showError(msg) {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').textContent = msg;
      document.getElementById('error').style.display = 'block';
    }

    function displayWinners(winners) {
      const grid = document.getElementById('winnersGrid');
      grid.innerHTML = '';

      winners.forEach((w, i) => {
        const card = document.createElement('div');
        card.className = `winner-card position-${i + 1} ${i === 1 ? 'top1' : ''}`;
        
        card.innerHTML = `
          <div class="winner-image-wrapper">
            <img src="${w.image}" class="winner-image" alt="${w.name}" loading="lazy">
          </div>
          <div class="winner-info">
            <div class="winner-code">${i === 1 ? 'üèÜ' : 'üéñÔ∏è'} ${w.code}</div>
            <div class="winner-name">${w.name}</div>
            <div class="winner-school">${w.school}</div>
            <div class="winner-age">Tu·ªïi: ${w.age}</div>
          </div>
        `;
        
        grid.appendChild(card);
      });

      document.getElementById('loading').style.display = 'none';
      document.getElementById('winnersSection').classList.add('show');
    }
  </script>

</body>
</html>
